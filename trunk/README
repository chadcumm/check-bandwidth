check_bandwidth 1.0.0
   ~ Nagios(r) SNMP Network Traffic Monitor Plugin
   ~ Copyright 2007, Jonathan Wright <jonathan (at) jabwebsolutions.co.uk>

-- ----------------------------------------------------------------------------

1. Introduction

  Based on check_traffic and check_snmp_cisco_ifstatus plugins (as both had
  features that I needed, but neither were quite right), check_bandwidth is a
  re-write from the ground up using perl's Net::SNMP library.

  Simply specify the hostname and interface number (plus community, if not 
  'public') and it will make a request against the device for the interface's 
  statistics.

  It's then compared against the cache of the last request and bandwidth is 
  calculated. If no cache exists (or --on-the-fly specified, preventing use of 
  the cache), then the program will sleep for a short period of time
  (controlled with --pause) before re-fetching the statistics and calculating
  the bandwidth.

  The program can output in either bits (by default) or bytes (using
  --use-bytes) and will convert all values into human-readable format by
  default (i.e. Kb, Mb, Gb...), unless forced to use Mb for all output with 
  --use-mega.

  Finally, warning & critical status reports can be set independently for each 
  direction, as well as calculated as a percentage of available bandwidth or 
  absolute (by specifying a suffix, such as 10M for 10 megabit, or 10 megabyte 
  if --use-bytes specified).

  Note: Nagios is a registered trademark of Ethan Galstad. 


2. Requirements

  To use this plugin you should have installed:
    1. Nagios(r) (http://www.nagios.org)
       This plugin was successfully tested with v2.8, and although should work
       with other version, is untested.

    2. Perl & Net::SNMP Module
       Was tested with Perl 5.8.8 and Net::SNMP 5.2.0 as well as Perl 5.8.5 and
       Net::SNMP 5.1.2.

    3. Read-only access to SNMP on the device(s) you want to question

  Plugin has been successfully tested on Gentoo Linux and CentOS4 servers, and
  should work on all distributions provided the above three critera match.


3. Quick install

  Please follow these steps to install check_bandwidth (it's pretty easy
  really - unpack, move and configure!)

    1. Unpack package into a temporary directory. (eg: /usr/tmp) and copy
       the check_bandwidth script into your plugins directory
         (e.g. /usr/nagios/libexec)

    2. By default, check_bandwidth will store all cache files under the
       directory /tmp/.traffic. If you want to change this, please edit the
       file and change the $_storage variable towards the top.

    3. Make sure check_bandwidth can create and/or write to the $_storage
       directory.

    4. Configure Nagios(r) to use the plugin with the command-line attributes
       that you require (see './check_bandwidth --help') for full details on
       all available options.

    5. Reload Nagios daemon.

4. Known Bugs & TODOs

    - The check-up function doesn't work at the moment as Net::SNMP resolves
      the statement 'INTEGER: down(2)' to 1, and 'INTEGER: up(1)' to 1 as well,
      so there's no way right now to check whether the interface is up or down.

    - The code used to determin if a cached file is out-of-date can become
      stale very quickly on fast ports (such as Gigabit ports), and in theory
      the port can cycle the counter after only a few seconds. Need to look
      into that.

    - As part of the above, try and update the code that works out the cycle
      value to be more dynamic - try and get the size of the counter (i.e. if
      it's Counter32 or Counter64) from the device and calculate it that way.

4. Notes

  This is the first release of this plugin, and while I have tested it
  successfully on my system, if you do some accross any unknown bugs, please
  feel free to drop me an e-mail on jonathan (at) jabwebsolutions.co.uk.

--
Jonathan Wright (Technical Director)
JAB Web Solutions Limited

http://www.jabwebsolutions.co.uk/
